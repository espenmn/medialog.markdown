<html>
<body>
<div class="previewbuttons">
  <p class="button-field context fa fa-eye-slash disabled" id="hidepreview"></p>
  <p class="button-field context fa fa-arrows disabled" id="previewv"></p>
  <p class="button-field context fa fa-eye" id="mdpreview"> Update Preview</p>
</div>
<textarea  class="markdown-textarea"
           type="textarea"
           role="markdown"  
           tal:attributes="id string:${view/id};
           name view/name;
           value view/value;
           disabled view/disabled;
           alt view/alt;
           accesskey view/accesskey;
           onselect view/onselect;"   
           tal:content="view/value"/>

<link rel="stylesheet" href="http://ace.jeka.by/assets/font-awesome/4.5.0/css/font-awesome.min.css" />
<div id="result"> </div>
<style>
.btn-group {display: inline}
#result, .md-header { width: 100%; display: block}
.md-header::after { height: 1px;clear:both; width: 100%; display: block}
.md-textarea {clear:both;}
.bodytext, #form-widgets-IMarkdownBehavior-bodytext  {float: left; }
.previewbuttons {float:right; }
.halfwidth { 
    width: 49% !important; clear: none; display: block;  
    margin-top: 10px;
	margin-bottom: 5px;
	border:  1px solid #CCC;
	padding: 10px;
	border-radius: 6px;
}

#result {overflow: scroll; float: right}
.disabled { opacity: 0.4}
</style>

<script tal:replace="structure view/make_buttons"></script>
<script>
$( "#mdpreview" ).click(function() {
var md = $('#form-widgets-IMarkdownBehavior-bodytext').val();
$.post("render_from_markdown", { markdown: md}, function( data ) {
  $('#result').show();
  $( "#result" ).html( data );
  $('#hidepreview,  #previewv').removeClass('disabled');
});
});
$( "#hidepreview" ).click(function() {
  $('#result').hide();
  $('#result, .md-textarea, #form-widgets-IMarkdownBehavior-bodytext').removeClass( 'halfwidth' );
  $('#hidepreview,  #previewv').addClass('disabled');
});
$( "#previewv" ).click(function() {
  $('#result, .md-textarea, #form-widgets-IMarkdownBehavior-bodytext').toggleClass( 'halfwidth' );
});
$(document).on('keypress', '#form-widgets-IMarkdownBehavior-bodytext', function(e) {
        if ( e.keyCode == 13 ) {  // detect the enter key
            $('#mdpreview').click(); // fire a sample click,  you can do anything
        }
});

</script>   
   
</body>
</html>
 
 
